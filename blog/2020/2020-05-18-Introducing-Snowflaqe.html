<html class="has-navbar-fixed-top" lang="en"><head><title>Fable Â· Introducing Snowflaqe</title><meta http-equiv="content-type" content="text/html; charset=UTF-8" charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/style.css"/><script src="https://unpkg.com/scroll-into-view-if-needed@2.2.28/umd/scroll-into-view-if-needed.min.js"></script></head><body><nav class="navbar is-fixed-top is-spaced"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/">Fable</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/docs">Documentation</a><a class="navbar-item is-hidden-mobile" href="/packages/">Packages</a><a class="navbar-item is-hidden-mobile" href="/repl/">Try</a><a class="navbar-item is-active" href="/blog/index.html">Blog</a><a class="navbar-item is-hidden-mobile" href="/community.html">Community</a><a class="navbar-item is-hidden-mobile" href="/resources.html">Resources</a><div class="navbar-item navbar-burger-dots is-hidden-tablet"><svg height="4" stroke="none" viewBox="0 0 22 4" width="22"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9,0)"></circle><circle cx="2" cy="2" r="2" transform="translate(18,0)"></circle></svg></div></div><div class="navbar-end is-hidden-mobile"><a class="navbar-item" href="https://github.com/fable-compiler/fable"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-item" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class=" fab fa-gitter fa-lg"></i></span></a><a class="navbar-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos"><span class="icon"><i class=" fab fa-youtube fa-lg"></i></span></a></div></div><div class="nacara-navbar-menu"><a class="nacara-navbar-menu-item" href="/packages/">Packages</a><a class="nacara-navbar-menu-item" href="/repl/">Try</a><a class="nacara-navbar-menu-item" href="/community.html">Community</a><a class="nacara-navbar-menu-item" href="/resources.html">Resources</a><a class="nacara-navbar-menu-item" href="https://github.com/fable-compiler/fable">Github</a><a class="nacara-navbar-menu-item" href="https://twitter.com/FableCompiler">Twitter</a><a class="nacara-navbar-menu-item" href="https://gitter.im/fable-compiler/Fable">Gitter</a><a class="nacara-navbar-menu-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos">Youtube</a></div></div></nav><div class="grey-overlay"></div><div class="nacara-content"><div class="container"><div class="columns"><div class="column is-8-desktop is-offset-2-desktop"><div class="section blog-post"><figure class="image is-96x96 author-image"><img class="is-rounded" src="https://github.com/Zaid-Ajaj.png"/></figure><h2 class="title is-size-3 has-text-primary has-text-weight-normal has-text-centered blog-title">Introducing Snowflaqe</h2><div class="tags has-addons is-justify-content-center"><a class="tag is-rounded is-medium is-primary" href="https://twitter.com/zaid_ajaj">Zaid-Ajaj</a><span class="tag is-rounded is-medium">May 18, 2020</span></div><div class="content"><style class=grvsc-styles>.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter::before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty::after{content:' ';-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line::before{content:' ';position:absolute;width:100%}.grvsc-line-diff-add::before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del::before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}.atom-one-light{background-color:#fafafa;color:#383a42}.atom-one-light .mtk14{color:#a626a4}.atom-one-light .mtk1{color:#383a42}.atom-one-light .mtk4{color:#c18401}.atom-one-light .grvsc-line-highlighted::before{background-color:var(--grvsc-line-highlighted-background-color,rgba(0,0,0,.05));box-shadow:inset var(--grvsc-line-highlighted-border-width,4px) 0 0 0 var(--grvsc-line-highlighted-border-color,rgba(0,0,0,.2))}</style><h2 id=introducing-snowflaqe>Introducing Snowflaqe<a href=#introducing-snowflaqe aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h2><p>In this blog post, we will introduce a new tool for Fable called <a href=https://github.com/Zaid-Ajaj/Snowflaqe>Snowflaqe</a> which will allow generating type-safe GraphQL clients for Fable applications. Though at first, let us talk about what the problem is that Snowflaqe solves and why it is needed.<h3 id=graphql-backends>GraphQL Backends<a href=#graphql-backends aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>While most web applications implement data exchange protocols between backend and frontend as a traditional REST API or some (g)RPC library, many modern applications have been implementing their backend API with <a href=https://graphql.org/>GraphQL</a> instead. Exposing a GraphQL API enables a rich and easy to use query language for different frontends and different clients. GraphQL has been very popular especially in the node.js community and it is now gaining momentum in .NET via the excellent <a href=https://github.com/graphql-dotnet/graphql-dotnet>graphql-dotnet</a> library and other platforms as well.<h3 id=type-safe-grapql-clients>Type-Safe GrapQL Clients<a href=#type-safe-grapql-clients aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>When a client communicates with a GraphQL backend, it sends a query. The query must be compatible with the exposed GraphQL schema from the backend in order to return the requested data (much like SQL queries).<p>The shape and structure of the data is very much dependent on the written query. This means that data returned from a query has a unique shape and type. For example, the following query:<pre class="atom-one-light grvsc-container"data-index=0 data-language><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source>query {</span></span>
<span class=grvsc-line><span class=grvsc-source>    posts {</span></span>
<span class=grvsc-line><span class=grvsc-source>        id</span></span>
<span class=grvsc-line><span class=grvsc-source>        title</span></span>
<span class=grvsc-line><span class=grvsc-source>        author {</span></span>
<span class=grvsc-line><span class=grvsc-source>            firstName</span></span>
<span class=grvsc-line><span class=grvsc-source>            lastName</span></span>
<span class=grvsc-line><span class=grvsc-source>        }</span></span>
<span class=grvsc-line><span class=grvsc-source>    }</span></span>
<span class=grvsc-line><span class=grvsc-source>}</span></span></code></pre><p>Might map to F# types as follows:<pre class="atom-one-light grvsc-container"data-index=1 data-language=fsharp><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Author</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    firstName</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string option</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    lastName</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string option</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Post</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    id</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    title</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    author</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Author</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>Query</span><span class=mtk1> </span><span class=mtk14>=</span><span class=mtk1> </span><span class=mtk14>{</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    posts</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>Post list</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>}</span></span></span></code></pre><blockquote><p>The types are of course imaginary here and are for demo purposes.</blockquote><p>Adding or removing properties from the query changes the type of the shape of data that is returned. Modelling the shape of the queries via F# types by hand can be a cumbersome task and is very error-prone: you as a developer have to lookup the individual types and making sure these align with the schema every time the schema changes.<h3 id=type-providers-to-the-rescue>Type-Providers to the rescue...?<a href=#type-providers-to-the-rescue aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>The first idea that F# developers get when looking at such problem is: "There must be a type provider for this!" and they would be right. In F# land, the awesome <a href=https://github.com/fsprojects/FSharp.Data.GraphQL>FSharp.Data.GraphQL</a> library gives the ability to write GraphQL backends and includes a type provider for type-safe clients in F#. Unfortunately, ever since Fable 2.0 came out around late 2018, that type provider <a href=https://github.com/fsprojects/FSharp.Data.GraphQL/issues/204>was no longer compatible</a> with Fable applications. I thought I could give it a try and fix the problem in the repository, even the maintainer <a href=https://github.com/johnberzy-bazinga>John Berzy</a> generously offered to help out but I couldn't get my head around the code base: type providers are really hard to write and to understand what exactly they are doing. Not to mention, I didn't enough experience in GraphQL itself to understand how the mapping worked by that time.<h3 id=snowflaqe-code-gen-back-to-business>Snowflaqe: code-gen back to business<a href=#snowflaqe-code-gen-back-to-business aria-hidden=true tabindex=-1><span class=anchor>#</span></a></h3><p>Instead of a type-provider, I thought I would start fresh from a new perspective and instead try to implement what many tools in the node.js ecosystem do: code-generate the client application! This is essentially what <a href=https://github.com/Zaid-Ajaj/Snowflaqe>Snowflaqe</a> does: it generates a fully functional F# <em>project</em> that can be referenced from Fable applications. The generation process uses a URL to the GraphQL backend to retrieve the schema from and an input directory containing the individual queries. The tool will first <em>validate</em> and <em>type-check</em> the queries against the schema and when everything is good, it starts to generate the actual project.<p>Snowflaqe is currently at v1.0 and it is distributed as a dotnet CLI tool, you can give it a try by installing it on your machine:<pre class="atom-one-light grvsc-container"data-index=2 data-language><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source>dotnet tool install snowflaqe -g</span></span></code></pre><p>If you wanted to build a GraphQL front-end using latest Fable, now you can. The tool is still very much in early days and I have only been developing it for the last 3 weeks. I used it at work for one of our Fable projects that talks to a GraphQL backend using complex queries and it works like a charm, I was really happy with the results. In case you have a project to try it out too, I am curious to hear your feedback.<blockquote><p>Currently Snowflaqe only supports Fable projects but in the future I plan to allow for other specialized generation targets such as F# on dotnet or on WebAssembly via <a href=https://fsbolero.io/>Bolero</a>. As always, PRs are welcome!</blockquote><p>You can learn more about Snowflaqe by reading the <a href=https://github.com/Zaid-Ajaj/Snowflaqe>docs on Github</a><p>I hope you enjoy using Snowflaqe.<p>Happy coding!</div></div></div></div></div></div><script async="" src="/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>