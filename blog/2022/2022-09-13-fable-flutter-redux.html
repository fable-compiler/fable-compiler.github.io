<html class="has-navbar-fixed-top" lang="en"><head><title>Fable Â· Flutter State in F# with Fable and Redux</title><meta http-equiv="content-type" content="text/html; charset=UTF-8" charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/style.css"/><script src="https://unpkg.com/scroll-into-view-if-needed@2.2.28/umd/scroll-into-view-if-needed.min.js"></script></head><body><nav class="navbar is-fixed-top is-spaced"><div class="container"><div class="navbar-brand"><a class="navbar-item title is-4" href="https://fable.io/">Fable</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/docs">Documentation</a><a class="navbar-item is-hidden-mobile" href="/packages/">Packages</a><a class="navbar-item is-hidden-mobile" href="/repl/">Try</a><a class="navbar-item is-active" href="/blog/index.html">Blog</a><a class="navbar-item is-hidden-mobile" href="/community.html">Community</a><a class="navbar-item is-hidden-mobile" href="/resources.html">Resources</a><div class="navbar-item navbar-burger-dots is-hidden-tablet"><svg height="4" stroke="none" viewBox="0 0 22 4" width="22"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9,0)"></circle><circle cx="2" cy="2" r="2" transform="translate(18,0)"></circle></svg></div></div><div class="navbar-end is-hidden-mobile"><a class="navbar-item" href="https://github.com/fable-compiler/fable"><span class="icon"><i class=" fab fa-github fa-lg"></i></span></a><a class="navbar-item" href="https://twitter.com/FableCompiler"><span class="icon"><i class=" fab fa-twitter fa-lg"></i></span></a><a class="navbar-item" href="https://gitter.im/fable-compiler/Fable"><span class="icon"><i class=" fab fa-gitter fa-lg"></i></span></a><a class="navbar-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos"><span class="icon"><i class=" fab fa-youtube fa-lg"></i></span></a></div></div><div class="nacara-navbar-menu"><a class="nacara-navbar-menu-item" href="/packages/">Packages</a><a class="nacara-navbar-menu-item" href="/repl/">Try</a><a class="nacara-navbar-menu-item" href="/community.html">Community</a><a class="nacara-navbar-menu-item" href="/resources.html">Resources</a><a class="nacara-navbar-menu-item" href="https://github.com/fable-compiler/fable">Github</a><a class="nacara-navbar-menu-item" href="https://twitter.com/FableCompiler">Twitter</a><a class="nacara-navbar-menu-item" href="https://gitter.im/fable-compiler/Fable">Gitter</a><a class="nacara-navbar-menu-item" href="https://www.youtube.com/channel/UC6m70Jyr65ogDySbK7aMmzg/videos">Youtube</a></div></div></nav><div class="grey-overlay"></div><div class="nacara-content"><div class="container"><div class="columns"><div class="column is-8-desktop is-offset-2-desktop"><div class="section blog-post"><figure class="image is-96x96 author-image"><img class="is-rounded" src="https://github.com/bentok.png"/></figure><h2 class="title is-size-3 has-text-primary has-text-weight-normal has-text-centered blog-title">Flutter State in F# with Fable and Redux</h2><div class="tags has-addons is-justify-content-center"><a class="tag is-rounded is-medium is-primary" href="https://blog.bencope.land/">Ben Copeland</a><span class="tag is-rounded is-medium">September 13, 2022</span></div><div class="content"><style class=grvsc-styles>.grvsc-container{overflow:auto;position:relative;-webkit-overflow-scrolling:touch;padding-top:1rem;padding-top:var(--grvsc-padding-top,var(--grvsc-padding-v,1rem));padding-bottom:1rem;padding-bottom:var(--grvsc-padding-bottom,var(--grvsc-padding-v,1rem));border-radius:8px;border-radius:var(--grvsc-border-radius,8px);font-feature-settings:normal;line-height:1.4}.grvsc-code{display:table}.grvsc-line{display:table-row;box-sizing:border-box;width:100%;position:relative}.grvsc-line>*{position:relative}.grvsc-gutter-pad{display:table-cell;padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-gutter{display:table-cell;-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter::before{content:attr(data-content)}.grvsc-source{display:table-cell;padding-left:1.5rem;padding-left:var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem));padding-right:1.5rem;padding-right:var(--grvsc-padding-right,var(--grvsc-padding-h,1.5rem))}.grvsc-source:empty::after{content:' ';-webkit-user-select:none;-moz-user-select:none;user-select:none}.grvsc-gutter+.grvsc-source{padding-left:.75rem;padding-left:calc(var(--grvsc-padding-left,var(--grvsc-padding-h,1.5rem))/ 2)}.grvsc-has-line-highlighting>.grvsc-code>.grvsc-line::before{content:' ';position:absolute;width:100%}.grvsc-line-diff-add::before{background-color:var(--grvsc-line-diff-add-background-color,rgba(0,255,60,.2))}.grvsc-line-diff-del::before{background-color:var(--grvsc-line-diff-del-background-color,rgba(255,0,20,.2))}.grvsc-line-number{padding:0 2px;text-align:right;opacity:.7}.atom-one-light{background-color:#fafafa;color:#383a42}.atom-one-light .mtk14{color:#a626a4}.atom-one-light .mtk1{color:#383a42}.atom-one-light .mtk10{color:#50a14f}.atom-one-light .mtk4{color:#c18401}.atom-one-light .mtk5{color:#e45649}.atom-one-light .mtk9{color:#4078f2}.atom-one-light .grvsc-line-highlighted::before{background-color:var(--grvsc-line-highlighted-background-color,rgba(0,0,0,.05));box-shadow:inset var(--grvsc-line-highlighted-border-width,4px) 0 0 0 var(--grvsc-line-highlighted-border-color,rgba(0,0,0,.2))}</style><p><img alt="fhsarp loves dart"src=../../static/img/blog/fsharp_loves_dart.png><blockquote><p>This article was originally posted <a href=https://blog.bencope.land/flutter-state-in-f-with-fable-and-redux/>here</a>.</blockquote><p><a href=https://fable.io/blog/2022/2022-06-06-Snake_Island_alpha.html>Fable 4.0 is on the horizon</a> ðŸŽ‰ and with it comes the ability to compile F# code to Dart. Although Fable 4 is still pre-release, the Dart compilation works great - so great that I was able to migrate the entirety of my Redux state management in a Flutter app over to F#. Being able to model data and dispatch actions in F# has made Flutter so much nicer to work with, so in this post I'll be sharing info about how to do the same approach in your own Flutter app.<p>I'd like to note up front that my approach here uses only the Fable 4 built-in Dart bindings, and I kept my Flutter widgets in Dart for now. It is possible write full-on Flutter widgets, as seen in <a href=https://github.com/alfonsogarciacaro/fable-flutterapp>this repo</a>, however for now it does require copying over the bindings from that repo at least until 4.0 is officially released. However, in my case I already had a sizable app that would have required making bindings for dozens of libraries and I was contrained on time. Since my Redux architecture did not involve any libraries and modelling state is a particularly verbose process in Dart, I determined that state would be a great place to start and that I could port the rest to F# later.<h2>Elegant Models in F#</h2><p>Flutter Redux is a pretty lightweight library in which you can write actions and reducers in plain Dart classes, combine them into a single app reducer, create a store which uses that reducer and use that store to update the state of all descendent widgets. I won't go into how to use Flutter Redux (here's a good article on that), other than covering important information with regards to using F# with it. For the most part, using Redux in Flutter can be written in pure Dart - which means that with Fable you can write that same code in F# with no need for additional Fable bindings. Consider this user model:<pre class="atom-one-light grvsc-container"data-index=0 data-language=dart><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>import</span><span class=mtk1> </span><span class=mtk10>'package:flutter/material.dart'</span><span class=mtk1>;</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>@immutable</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>class</span><span class=mtk1> </span><span class=mtk4>UserModel</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>final</span><span class=mtk1> </span><span class=mtk4>String</span><span class=mtk1> firstName;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>final</span><span class=mtk1> </span><span class=mtk4>String</span><span class=mtk1> lastName;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>final</span><span class=mtk1> </span><span class=mtk4>String</span><span class=mtk1> email;</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>const</span><span class=mtk1> </span><span class=mtk4>UserModel</span><span class=mtk1>({</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk5>this</span><span class=mtk1>.firstName = </span><span class=mtk10>''</span><span class=mtk1>,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk5>this</span><span class=mtk1>.lastName = </span><span class=mtk10>''</span><span class=mtk1>,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk5>this</span><span class=mtk1>.email = </span><span class=mtk10>''</span><span class=mtk1>,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  });</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>@override</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>bool</span><span class=mtk1> </span><span class=mtk14>operator</span><span class=mtk1> ==(</span><span class=mtk4>Object</span><span class=mtk1> other) =></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      </span><span class=mtk9>identical</span><span class=mtk1>(</span><span class=mtk5>this</span><span class=mtk1>, other) ||</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      other is </span><span class=mtk4>ClassSliceModel</span><span class=mtk1> &#38&amp</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>          runtimeType == other.runtimeType &#38&amp</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>          firstName == other.lastName &#38&amp</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>          lastName == other.lastName &#38&amp</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>          email == other.email;</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>@override</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>int</span><span class=mtk1> </span><span class=mtk14>get</span><span class=mtk1> </span><span class=mtk9>hashCode</span><span class=mtk1> =></span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      firstName.hashCode ^</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      lastname.hashCode ^</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      email.hashCode;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span></code></pre><p>Now with Fable, we can write the same code as follows:<pre class="atom-one-light grvsc-container"data-index=1 data-language=f#><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>UserModel</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>{</span><span class=mtk1> firstName</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      lastName</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      email</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>string </span><span class=mtk14>}</span></span></span></code></pre><p>The above compiles to the same original Dart code (minus the @immutable decorator from Material). The compiled file <code>user_model.fs</code>.dart can now be imported and used in a Dart file just like the original model.<h2>Actions</h2><p>In Flutter Redux, actions also can be written in pure Dart which, again, means that we'll have no problem writing the same thing in F#. Given the UserModel class above, here is what the Redux actions might look like.<pre class="atom-one-light grvsc-container"data-index=2 data-language=dart><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>class</span><span class=mtk1> </span><span class=mtk4>FirstNameChanged</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>String</span><span class=mtk1> firstName;</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>FirstNameChanged</span><span class=mtk1>(</span><span class=mtk5>this</span><span class=mtk1>.firstName);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>class</span><span class=mtk1> </span><span class=mtk4>LastNameChanged</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>String</span><span class=mtk1> lastName;</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>LastNameChanged</span><span class=mtk1>(</span><span class=mtk5>this</span><span class=mtk1>.lastName);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>class</span><span class=mtk1> </span><span class=mtk4>EmailChanged</span><span class=mtk1> {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>String</span><span class=mtk1> email;</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk4>EmailChanged</span><span class=mtk1>(</span><span class=mtk5>this</span><span class=mtk1>.email);</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span></code></pre><p>The same in F#:<pre class="atom-one-light grvsc-container"data-index=3 data-language=f#><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>UserActions</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> FirstNameChanged </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> LastNameChanged </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>string</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> EmailChanged </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>string</span></span></span></code></pre><h2>Reducers</h2><p>Reducers in Dart tend to be large if/else statements, or maybe switch statements, which check for the type of the action and look like this:<pre class="atom-one-light grvsc-container"data-index=4 data-language=dart><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk4>UserModel</span><span class=mtk1> </span><span class=mtk9>userReducer</span><span class=mtk1>(</span><span class=mtk4>UserModel</span><span class=mtk1> state, </span><span class=mtk4>dynamic</span><span class=mtk1> action) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>if</span><span class=mtk1> (action is </span><span class=mtk4>FirstNameChanged</span><span class=mtk1>) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk4>UserModel</span><span class=mtk1>(</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      firstName: action.firstName,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      lastName: state.lastName,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      email: state.email,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    );</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>if</span><span class=mtk1> (action is </span><span class=mtk4>LastNameChanged</span><span class=mtk1>) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk4>UserModel</span><span class=mtk1>(</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      firstName: state.firstName,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      lastName: action.lastName,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      email: state.email,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    );</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>if</span><span class=mtk1> (action is </span><span class=mtk4>EmailChanged</span><span class=mtk1>) {</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>return</span><span class=mtk1> </span><span class=mtk4>UserModel</span><span class=mtk1>(</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      firstName: state.firstName,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      lastName: state.lastName,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>      email: action.email,</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    );</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  }</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>  </span><span class=mtk14>return</span><span class=mtk1> state;</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>}</span></span></span></code></pre><p>The same in F#:<pre class="atom-one-light grvsc-container"data-index=5 data-language=f#><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>userReducer</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>state</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>AppStateModel</span><span class=mtk14>,</span><span class=mtk1> action</span><span class=mtk14>:</span><span class=mtk1> </span><span class=mtk4>UserActions</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>{</span><span class=mtk1> state </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>        user </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>match</span><span class=mtk1> action </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> FirstNameChanged x </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>{</span><span class=mtk1> state.user </span><span class=mtk14>with</span><span class=mtk1> firstName </span><span class=mtk14>=</span><span class=mtk1> x </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> LastNameChanged x </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>{</span><span class=mtk1> state.user </span><span class=mtk14>with</span><span class=mtk1> lastName </span><span class=mtk14>=</span><span class=mtk1> x </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>            </span><span class=mtk14>|</span><span class=mtk1> EmailChanged x </span><span class=mtk14>-></span><span class=mtk1> </span><span class=mtk14>{</span><span class=mtk1> state.user </span><span class=mtk14>with</span><span class=mtk1> email </span><span class=mtk14>=</span><span class=mtk1> x </span><span class=mtk14>}</span><span class=mtk1> </span><span class=mtk14>}</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span></code></pre><p>One other thing to note is that, while Dart could have independent, modular reducers because of the <code>dynamic</code> type, in F# we'll need to have a single global discriminated union to allow us to pattern match on which reducer within the global state we need to dispatch to. So we'll also have a reducer that looks like this for the whole app:<pre class="atom-one-light grvsc-container"data-index=6 data-language=f#><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>type</span><span class=mtk1> </span><span class=mtk4>AppActions</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> UserDispatch </span><span class=mtk14>of</span><span class=mtk1> </span><span class=mtk4>UserActions</span></span></span>
<span class=grvsc-line><span class=grvsc-source></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>appReducer</span><span class=mtk1> </span><span class=mtk14>(</span><span class=mtk1>state</span><span class=mtk14>,</span><span class=mtk1> action</span><span class=mtk14>)</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>match</span><span class=mtk1> action </span><span class=mtk14>with</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|</span><span class=mtk1> UserDispatch action </span><span class=mtk14>-></span><span class=mtk1> userReducer </span><span class=mtk14>(</span><span class=mtk1>state</span><span class=mtk14>,</span><span class=mtk1> action</span><span class=mtk14>)</span></span></span></code></pre><h2>Dispatching Events</h2><p>Now with the essential elements of a Redux state converted from Dart to F#, we can look at how to dispatch events. Before with Dart, we'd dispatch an event by importing the Action class directly like so:<pre class="atom-one-light grvsc-container"data-index=7 data-language=dart><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk1>store.</span><span class=mtk9>dispatch</span><span class=mtk1>(</span><span class=mtk4>FirstNameChanged</span><span class=mtk1>(</span><span class=mtk10>'Bob'</span><span class=mtk1>));</span></span></span></code></pre><p>The F# code compiles disciminated unions to functions that are namespaced by the type's name. So <code>FirstNameChanged</code> on the UserActions discriminated union compiles to <code>UserActions_FirstNameChanged</code>. But also remember that the root reducer is now a monolithic state instead of a modular one, so we also need to dispatch the top-level reducer's action. Given the appReducer above, it would look like this <code>AppActions_UserDispatch(UserActions_FirstNameChanged('Bob'))</code>.<p>That is a bit verbose though, so we can create functions in F# that compose the correct functions together in a friendlier name:<pre class="atom-one-light grvsc-container"data-index=8 data-language=f#><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>firstNameChanged</span><span class=mtk1> </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    UserDispatch </span><span class=mtk14>&#60&lt;</span><span class=mtk1> FirstNameChanged</span></span></span></code></pre><p>Now in our Dart code we can dispatch our actions by importing the function we just wrote in F# with <code>store.dispatch(firstNameChanged('Bob'))</code>.<h2>Selectors</h2><p>Having all of this code in F# is already making state management much more pleasant, but there's a cherry on top as well. Although Dart has some nice built in utilities for collections, now you have access to wonderful FShare.Core modules such as the List module. So now you can create a UserSelectors module to grab data from the store and easily shape it - stuff like this:<pre class="atom-one-light grvsc-container"data-index=9 data-language=dart><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk9>selectUsersGroupedByCompany</span><span class=mtk1>(state)</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    .</span><span class=mtk9>map</span><span class=mtk1>((e) => </span><span class=mtk9>buildSomeWidget</span><span class=mtk1>(e));</span></span></span></code></pre><p>Where <code>selectUsersGroupedByCompany</code> is written in F# like so:<pre class="atom-one-light grvsc-container"data-index=10 data-language=f#><code class=grvsc-code><span class=grvsc-line><span class=grvsc-source><span class=mtk14>let</span><span class=mtk1> </span><span class=mtk5>selectUsersGroupedByCompany</span><span class=mtk1> state </span><span class=mtk14>=</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    state.users</span></span></span>
<span class=grvsc-line><span class=grvsc-source><span class=mtk1>    </span><span class=mtk14>|></span><span class=mtk1> List.groupBy </span><span class=mtk14>(fun</span><span class=mtk1> u </span><span class=mtk14>-></span><span class=mtk1> u.Company</span><span class=mtk14>)</span></span></span></code></pre><p>Although <code>groupBy</code> isn't a great example because you can do it fairly tersely in Dart, a lot of more verbose Dart code can now be written written in F# utilities.<h2>Conclusion</h2><p>Fable 4 now gives us the ability to compile F# to Dart, and it's been an incredibly smooth process for me, even with it only just now reaching beta. In my case, I have a hybrid application with both Dart code and F# code. The most expedient approach for me for now was to only write my state in F# and much of the most imporant logic ended up there, while I left the dependency-heavy widgets in Dart for now. Interacting with the compiled code from Dart files has been pleasant as well.<p>Despite only having partially written my app with Fable, I look forward to eventually writing everything with it (I also would like to try writing a game in Flutter and F#). If you are a Dart or Flutter developer who loves F#, you should definitely give it a try.</div></div></div></div></div></div><script async="" src="/resources/nacara-standard-layouts/scripts/menu.js"></script></body></html>